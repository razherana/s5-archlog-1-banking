<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Détail du Compte - Banking Interface</title>
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <div class="header">
      <h1>Banking Interface System</h1>
    </div>

    <div class="container">
      <div class="user-info">
        <span>Welcome, <strong th:text="${userName}">User</strong></span>
        <a href="../logout" class="logout-link">Logout</a>
        <div style="clear: both"></div>
      </div>

      <div class="card">
        <h2 class="text-center">Détail du Compte Courant</h2>
        <p class="text-center" style="margin-bottom: 2rem">
          <a href="../comptes-courants">← Retour à la liste des comptes</a>
        </p>

        <!-- Error Messages -->
        <div th:if="${param.error}" class="alert alert-error">
          <p th:text="${param.error[0]}">Erreur API</p>
        </div>

        <!-- Success Messages -->
        <div th:if="${param.success}" class="alert alert-success">
          <p th:if="${param.success[0] == 'deposit_success'}">
            Dépôt effectué avec succès!
          </p>
          <p th:if="${param.success[0] == 'withdrawal_success'}">
            Retrait effectué avec succès!
          </p>
          <p th:if="${param.success[0] == 'tax_payment_success'}">
            Paiement de taxe effectué avec succès!
          </p>
        </div>

        <!-- Account Information -->
        <div class="account-info-section">
          <h3>Informations du Compte</h3>
          <div class="account-details">
            <div class="detail-row">
              <span class="label">Numéro de Compte:</span>
              <span class="value" th:text="${account.numeroCompte}"
                >ACCT-00000001</span
              >
            </div>
            <div class="detail-row">
              <span class="label">Solde Actuel:</span>
              <span
                class="value"
                th:class="${account.solde >= 0} ? 'positive-balance' : 'negative-balance'"
                th:text="${#numbers.formatDecimal(account.solde, 1, 2)} + ' MGA'"
                >0.00 MGA</span
              >
            </div>
            <div class="detail-row">
              <span class="label">Date d'Ouverture:</span>
              <span
                class="value"
                th:text="${#temporals.format(account.dateOuverture, 'dd/MM/yyyy HH:mm')}"
                >01/01/2024 10:00</span
              >
            </div>
            <div class="detail-row">
              <span class="label">Taxe Mensuelle:</span>
              <span
                class="value"
                th:text="${#numbers.formatDecimal(account.taxe, 1, 2)} + ' MGA'"
                >0.00 MGA</span
              >
            </div>
            <div class="detail-row" th:if="${taxToPay > 0}">
              <span class="label">Taxe à Payer:</span>
              <span
                class="value negative-balance"
                th:text="${#numbers.formatDecimal(taxToPay, 1, 2)} + ' MGA'"
                >0.00 MGA</span
              >
            </div>
          </div>
        </div>

        <!-- Transaction Actions -->
        <div class="transaction-actions">
          <h3>Actions</h3>

          <!-- Deposit Form -->
          <div class="transaction-form">
            <h4>Effectuer un Dépôt</h4>
            <form method="post" action="detail" class="action-form">
              <input type="hidden" name="accountId" th:value="${account.id}" />
              <input type="hidden" name="action" value="deposit" />

              <div class="form-group">
                <label for="deposit-amount">Montant (MGA):</label>
                <input
                  type="number"
                  id="deposit-amount"
                  name="montant"
                  step="0.01"
                  min="0.01"
                  placeholder="1000.00"
                  class="form-input"
                  required
                />
              </div>

              <div class="form-group">
                <label for="deposit-description"
                  >Description (optionnel):</label
                >
                <input
                  type="text"
                  id="deposit-description"
                  name="description"
                  placeholder="Description du dépôt"
                  class="form-input"
                />
              </div>

              <div class="form-group">
                <label for="deposit-actionDateTime"
                  >Date/Heure de l'action (optionnel):</label
                >
                <input
                  type="datetime-local"
                  id="deposit-actionDateTime"
                  name="actionDateTime"
                  class="form-input"
                />
                <small class="form-help">
                  Laissez vide pour utiliser l'heure actuelle
                </small>
              </div>

              <button type="submit" class="btn btn-success">
                Effectuer le Dépôt
              </button>
            </form>
          </div>

          <!-- Withdrawal Form -->
          <div class="transaction-form">
            <h4>Effectuer un Retrait</h4>
            <form method="post" action="detail" class="action-form">
              <input type="hidden" name="accountId" th:value="${account.id}" />
              <input type="hidden" name="action" value="withdraw" />

              <div class="form-group">
                <label for="withdraw-amount">Montant (MGA):</label>
                <input
                  type="number"
                  id="withdraw-amount"
                  name="montant"
                  step="0.01"
                  min="0.01"
                  th:max="${account.solde}"
                  placeholder="500.00"
                  class="form-input"
                  required
                />
                <small class="form-help">
                  Solde disponible:
                  <span
                    th:text="${#numbers.formatDecimal(account.solde, 1, 2)} + ' MGA'"
                    >0.00 MGA</span
                  >
                </small>
              </div>

              <div class="form-group">
                <label for="withdraw-description"
                  >Description (optionnel):</label
                >
                <input
                  type="text"
                  id="withdraw-description"
                  name="description"
                  placeholder="Description du retrait"
                  class="form-input"
                />
              </div>

              <div class="form-group">
                <label for="withdraw-actionDateTime"
                  >Date/Heure de l'action (optionnel):</label
                >
                <input
                  type="datetime-local"
                  id="withdraw-actionDateTime"
                  name="actionDateTime"
                  class="form-input"
                />
                <small class="form-help">
                  Laissez vide pour utiliser l'heure actuelle
                </small>
              </div>

              <button
                type="submit"
                class="btn btn-primary"
                th:disabled="${account.solde <= 0}"
              >
                Effectuer le Retrait
              </button>
            </form>
          </div>

          <!-- Tax Payment Form -->
          <div class="transaction-form">
            <h4>Payer les Taxes</h4>
            <form method="post" action="detail" class="action-form">
              <input type="hidden" name="accountId" th:value="${account.id}" />
              <input type="hidden" name="action" value="pay_tax" />

              <div class="form-group" th:if="${taxToPay > 0}">
                <label>Montant de la Taxe à Payer:</label>
                <div class="tax-amount">
                  <span
                    th:text="${#numbers.formatDecimal(taxToPay, 1, 2)} + ' MGA'"
                    >0.00 MGA</span
                  >
                </div>
                <small class="form-help">
                  Ce montant correspond aux taxes impayées pour ce compte.
                </small>
              </div>

              <div class="form-group">
                <label for="tax-actionDateTime"
                  >Date/Heure de l'action (optionnel):</label
                >
                <input
                  type="datetime-local"
                  id="tax-actionDateTime"
                  name="actionDateTime"
                  class="form-input"
                />
                <small class="form-help">
                  Laissez vide pour utiliser l'heure actuelle
                </small>
              </div>

              <button
                type="submit"
                class="btn btn-warning"
              >
                Payer les taxes
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
